/*!build time : 2013-10-15 8:28:41 PM*/
KISSY.add("gallery/storage/1.0/conf",function(a){var b=location.href.indexOf("mbar-debug=1")>-1,c=location.href.indexOf("mbar-debug-log=1")>-1,d=window.TB,e=d&&d.globalToolFn&&a.isFunction(d.globalToolFn.isDaily)?d.globalToolFn.isDaily():location.hostname.indexOf(".net")>=0||location.hostname.indexOf(".com.hk")>=0,f="http://gm.mmstat.com",g={VER:"1.1.0",DEBUG:b,DEBUG_LOG:c,IS_DAILY:e,SKIN:"mui-mbar-d11",TAB_W:50,ZINDEX:999999,SAMPLING:.005,SAM_PV:.001,EASE:"easeOut",BUBBLE_PAD:5,COMMON_DELAY:100,TIMEOUT_TOP:5e3,TIMEOUT_STORAGE:3e3,DEGRADE:-99,BUBBLE_HIDE_DELAY:6e3,AVATAR:e?"http://wsapi.jianghu.daily.taobao.net/avatar/getAvatar.do?userId={0}&width={1}&height={1}&type=ww":"http://wwc.taobaocdn.com/avatar/getAvatar.do?userId={0}&width={1}&height={1}&type=sns",CAT:"http://img04.taobaocdn.com/tps/i4/T1VaaiFdpdXXXtxVjX.swf",AR:f,CK_USED:"_mr",NO_IMG:"http://img01.taobaocdn.com/tps/i1/T1aYCaFaVcXXX6DYsb-100-100.gif",STORAGE_PROXY:"http://g.tbcdn.cn/kissy/gallery/storage/1.0/proxy.html",DOMAIN:e?".tmall.net":".tmall.com",ARR:{S12:f+"/tmallbrand.99.1",S21:f+"/tmallbrand.99.2",S32:f+"/tmallbrand.99.9",PROF_BUB_SHOW:f+"/tmallbrand.99.19",PROF_BUB_CLICK:f+"/tmallbrand.99.20",PROF_BUB_LINK_CLICK:f+"/tmallbrand.99.21",COUPON_AVAILABLE_SHOW:f+"/tmallbrand.99.7",COUPON_AVAILABLE_CLICK:f+"/tmallbrand.99.10",COUPON_7_SHOW:f+"/tmallbrand.99.13",COUPON_1_SHOW:f+"/tmallbrand.99.14",COUPON_7_CLICK:f+"/tmallbrand.99.15",COUPON_1_CLICK:f+"/tmallbrand.99.16",COUPON_FLY_BUB_SHOW:f+"/tmallbrand.99.26",COUPON_FLY_BUB_CLICK:f+"/tmallbrand.99.27",BONUS_FLY_BUB_SHOW:f+"/tmallbrand.99.28",BONUS_FLY_BUB_CLICK:f+"/tmallbrand.99.29",BONUS_AVAILABLE_BUB_SHOW:f+"/tmallbrand.99.30",BONUS_AVAILABLE_BUB_CLICK:f+"/tmallbrand.99.31",BRAND_FLY_BUB_SHOW:f+"/tmallbrand.99.23",BRAND_FLY_BUB_CLICK:f+"/tmallbrand.99.24",BRAND_FLY_BUB_LINK_CLICK:f+"/tmallbrand.99.25",LIVE_SHOW:f+"/tmallbrand.99.8",LIVE_CLICK:f+"/tmallbrand.99.11",LIVE_BUB_LINK_CLICK:f+"/tmallbrand.99.22",FOOT_BUBBLE:f+"/tmallbrand.99.17",FOOT_BUBBLE_CLICK:f+"/tmallbrand.99.18",FOOT_FLY_BUB_SHOW:f+"/tmallbrand.99.32",FOOT_FLY_BUB_CLICK:f+"/tmallbrand.99.33",FOOT_PIN_ITEM:f+"/tmallbrand.99.40",FOOT_DELETE_ITEM:f+"/tmallbrand.99.41",FOOT_CLEAR_HISTORY:f+"/tmallbrand.99.42",FOOT_UNPIN_ITEM:f+"/tmallbrand.99.43",PV:f+"/tmallbrand.999.1",LOGIN1:f+"/tmallbrand.999.2",LOGIN2:f+"/tmallbrand.999.3",RETINA:f+"/tmallbrand.999.4",ST_SET:f+"/tmallbrand.999.5",ST_GET:f+"/tmallbrand.999.6",ST_RM:f+"/tmallbrand.999.7",ST_CL:f+"/tmallbrand.999.8",FOOT_MORE_CLICK:f+"/tmallbrand.999.9",EXP1:f+"/tmallbrand.999.11",EXP2:f+"/tmallbrand.999.12",EXP3:f+"/tmallbrand.999.13",TIME1s:f+"/tmallbrand.999.14",TIME1m:f+"/tmallbrand.999.15",TIME1h:f+"/tmallbrand.999.16",TIME1d:f+"/tmallbrand.999.17",INCOGNITO:f+"/tmallbrand.999.18",CLEAR:f+"/tmallbrand.999.19",EXP7:f+"/tmallbrand.999.20"},K:{IFRAME:"iframe",XD:"xd",XD_TIMEOUT:"xdTimeout",IFRAME_TIMEOUT:"iframeTimeout",PROXY:"proxy",CALLBACK_LIST:"callbackList",CACHED_ACTION_LIST:"cachedActionList",PROXY_READY:"proxyReady"}};return g}),KISSY.add("gallery/storage/1.0/util",function(a,b){var c={log:function(){b.DEBUG_LOG&&window.console&&window.console.log&&window.console.log.apply&&window.console.log.apply(window.console,arguments)},fm:function(){if(0==arguments.length)return"";if(1==arguments.length)return arguments[0];var a,b=arguments[0];for(a=1;a<arguments.length;++a){var c=new RegExp("\\{"+(a-1)+"\\}","g");b=b.replace(c,arguments[a])}return b}},d=c;return d.sendLog=function(a){if(a){var b=new Image;b.src=a}},d},{requires:["./conf"]}),KISSY.add("gallery/storage/1.0/xd",function(a,b,c){function d(){r?b.on(q,"message",e):u.onMessage(e)}function e(b){var d={};try{d=c.parse(b.data)}catch(e){return}if(h in d&&i in d){var f=d[i];if(f){var g=s[f];if(clearTimeout(g),s[f]=0,!g)return}a.each(t,function(a){a.get(j)(d)})}}function f(a){var b=this;if(++v>1)throw"XD is singleton";b._opt=a,b.init()}var g=0,h="__ga_xd_from",i="__ga_xd_to",j="receive",k="target",l="timeout",m="iframeTimeout",n=10,o=10,p=3e3,q=window,r=q.postMessage,s={},t=[],u={uid:0,hid:-1,q:[],tm:0,postMessage:function(a,b){var c=++u.uid,d=u.q,e={name:+new Date+""+c+"^"+document.domain+"&"+b,uid:c,target:a};d.push(e),u.tm||(u.tm=setInterval(function(){var a=u.q;if(!(0===a.length||a[0].uid<=u.hid)){var b=a[0];u.hid=b.uid,b.target.name=b.name}},o))},onMessage:function(a){function b(){var b=q.name;if(b!==c){u.q.shift(),c=b;var e=d.exec(b);if(!e)return;var f={origin:e[2],data:e[3]};a&&a(f)}}var c="",d=/^(\d+?)\^(.+?)&(.*?)$/;setInterval(b,n)}};d();var v=0;return a.augment(f,{init:function(){var a=this;t.push(a)},send:function(b,d){function f(){var a={};a.origin="*";var d={};d.c=b.c||"",d[h]=0,d[i]=0,a.data=c.stringify(d),e(a)}if(a.isObject(b)){var j=this,n=j.get(k),o=j.get(l)||p,q=++g;d=d||"*",b[i]=b[h]||0,b[h]=q;var t=c.stringify(b);s[q]=setTimeout(function(){s[q]=0,f()},o),j.get(m)?f():r?n.postMessage(t,d):u.postMessage(n,t,d)}},get:function(a){return this._opt[a]},set:function(a,b){this._opt[a]=b}}),f},{requires:["event","json"]}),KISSY.add("gallery/storage/1.0/index",function(a,b,c,d,e,f){var g={},h=0,i=function(b){var c=this;c._opt=a.merge(g,b),c.init()};return a.augment(i,{init:function(){function b(b){g.setConf(d.K.PROXY_READY,!0);var c=new f({target:h.contentWindow,iframeTimeout:b,timeout:g.getConf(d.K.XD_TIMEOUT),receive:function(a){var b=g.getConf(d.K.CALLBACK_LIST),c=b[a.c];if(c){c(a.v);try{delete b[a.c]}catch(e){}}}});g.setConf(d.K.XD,c);var e=g.getConf(d.K.CACHED_ACTION_LIST);a.each(e,function(a){c.send(a,"*")}),g.setConf(d.K.CACHED_ACTION_LIST,[])}function c(){e.log("storage proxy loaded"),clearTimeout(j),j&&setTimeout(function(){b(!1)},100)}var g=this;g.setConf(d.K.CALLBACK_LIST,{}),g.setConf(d.K.CACHED_ACTION_LIST,[]),g.setConf(d.K.PROXY_READY,!1);var h=document.createElement("iframe"),i=h.style;i.display="none";var j=-1;j=setTimeout(function(){j=0,b(!0)},g.getConf(d.K.IFRAME_TIMEOUT)||d.TIMEOUT_STORAGE),h.src=g.getConf(d.K.PROXY),h.attachEvent?h.attachEvent("onload",c):h.onload=c,document.body.appendChild(h)},send:function(b){var c=this,e=c.getConf(d.K.CALLBACK_LIST),f=c.getConf(d.K.CACHED_ACTION_LIST),g=c.getConf(d.K.PROXY_READY);if(b.p="mui/mallbar",a.isFunction(b.success)){var i="token"+ ++h;b.c=i,e[i]=b.success;try{delete b.success}catch(j){}}if(!g)return f.push(b),void 0;var k=c.getConf(d.K.XD);k&&k.send(b)},get:function(a){a=a||{},a.m="get",this.send(a),Math.random()<d.SAM_PV&&e.sendLog(d.ARR.ST_GET)},set:function(a){a=a||{},a.m="set",this.send(a),Math.random()<d.SAM_PV&&e.sendLog(d.ARR.ST_SET)},remove:function(a){a=a||{},a.m="remove",this.send(a),Math.random()<d.SAM_PV&&e.sendLog(d.ARR.ST_RM)},clear:function(a){a=a||{},a.m="clear",this.send(a),Math.random()<d.SAM_PV&&e.sendLog(d.ARR.ST_CL)},getConf:function(a){return this._opt[a]},setConf:function(a,b){this._opt[a]=b}}),new i({proxy:d.STORAGE_PROXY})},{requires:["event","json","./conf","./util","./xd"]});